<tool id="gff_align" name="GFF align" version="0.1.0" python_template_version="3.5">
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        GFFalign.py

        $aln
        $queryGff
        $targetGff
        
        $fd

        -t $t
        -v $v

        > '$output_file'
    ]]></command>
    <inputs>
        <param name="aln" type="data" format="tabular" label="Alignement file" help="Alignment file in TAB format. The suggested way to obtain it is to run Last and than convert the file from MAF to TAB with maf-convert" />
        <param name="queryGFF" type="data" format="gff" label="Query organism GFF file" help="Gff file of the query organism. The gene IDs in the GFF must be unique. To solve the problem please extract only the 'gene' lines. Try to format the file with AWK: awk `{if ($3==\'gene\') print $0}` GFFfile" />
        <param name="targetGFF" type="data" format="gff" label="Target organism GFF file" help="Gff file of the 'target' organism. The gene IDs in the GFF must be unique. To solve the problem please extract only the gene lines as explained in queryGff" />

        <!--<param argument="uq" type="boolean" checked="false" truevalue="--use-query-database" falsevalue="" label="Use query database" help="Use this parament if you already have a query gffutils formatted database or if it's not the first time you run this script" />-->
        <!--<param argument="ut" type="boolean" checked="false" truevalue="--use-target-database" falsevalue="" label="Use target database" help="Use this parament if you already have a target gffutils formatted database or if it's not the first time you run this script" />-->
        <param argument="fd" type="boolean" checked="false" truevalue="--force-database" falsevalue="" label="Force database" help="Delete old gffutils databases and create new ones" />
        <!--<param name="m" type="boolean" checked="false" truevalue="-memory" falsevalue="" label="Memory" help="Create an in-memory database. This option can't be used with the other DB options. Probably usefull in Galaxy integration" />-->
        <!--<param arg="e" type="boolean" checked="false" truevalue="-extract" falsevalue="" label="Extract" help="Extract the fasta sequence of the new suggested gene. It takes two argument: the fasta file of the genome and the name of the output file. This will slow down the process A LOT." />
        -e $genome_fasta_file $output_file_name-->

        <param argument="t" type="integer" value="30" label="Interval" help="Interval, in nucleotide, within a gene is considered in the same position." />
        <param argument="v" type="select" multiple="true" label="Verbosity" help="Output options. If not specify the software shows only the genes that are in the exact position of the genes in the target. It's possible to show annotated genes that are in aligned regions but that have different lengths or in slightly different positions. It's possible to select multiple values." >
            <option value="All">All</option>
            <option value="shorter">Shorter</option>
            <option value="longer">Longer</option>
            <option value="offset">Offset</option>
            <option value="new" selected="true">New</option>
            <option value="confirmed">Confirmed</option>
        </param>
    </inputs>
    <outputs>
        <data name="output_file" format="gff" label="GFF align from ${on_string}" />
    </outputs>

    <tests>
        <test>
            <param name="aln" value="genome_aln.tab" ftype="tabular"/>
            <param name="queryGFF" value="query.gff" ftype="gff"/>
            <param name="targetGFF" value="target.gff" ftype="gff"/>
            <output name="output" file="outptut.gff" ftype="gff"/>
        </test>
    </tests>


    <help><![CDATA[
        Tool to extract genes coordinates from a whole genome alignent.
        This script needs an alignement in TAB format and two gff files.
    ]]></help>
</tool>
